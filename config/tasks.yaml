parse_location:
  description: >
    Extract the basin name from the natural language input:
    {input_text}
    
    Your task is to identify and validate the basin name mentioned
    in the text. Ensure the name is correctly formatted and matches
    known basin names.
  expected_output: >
    The validated basin name as a string.

parse_time_period:
  description: >
    Extract the time period from the natural language input:
    {input_text}
    
    Your task is to identify the start and end dates mentioned
    in the text and convert them to datetime objects. If the user
    mentions a flash flood, use web search/news to confirm the event
    time/location if available, keep the time range short (maximum 5 days),
    and ensure it spans from
    flood start through peak to end. Return ONLY the two datetime objects,
    nothing else.
  expected_output: >
    ONLY two python datetime objects: [start_date, end_date]
    representing the simulation period. Do not include any other text,
    explanations, or formatting - just the two datetime objects.

get_basin_center:
  description: >
    Given the basin name: '{basin_name}' and the user's original input text: '{input_text}',
    output the approximate latitude and longitude of a point within this basin as a Python tuple (lat, lon).
    
    IMPORTANT: The basin_name may not be correctly parsed. Always prioritize the user's original 
    input text to understand their specific geographic intent. They may mention specific regions, 
    cities, or areas that should take precedence over the parsed basin name.
    
    Carefully analyze the user's original input text first to identify any specific locations, 
    coordinates, or geographic references. Use web search/news when available to confirm
    event locations referenced in the input (e.g., flash floods). The coordinates should reflect the user's intended 
    location while ensuring the point is guaranteed to be inside the basin boundaries.
    
    If the user mentions specific locations, prioritize those areas over the parsed basin name. 
    If you are unsure, make your best estimate based on the user's original input and common 
    knowledge of major basins, but always ensure the point aligns with the user's geographic 
    specifications from their original input rather than relying solely on the parsed basin name.
  expected_output: >
    A tuple of floats: (latitude, longitude) representing a point inside the basin
    that accurately reflects the user's intended location from their original input,
    prioritizing the user's input over the parsed basin name.

write_report:
  description: |
    ROLE AND OBJECTIVE
    You are the Report Writer Agent within a Level-4 Hydrologic AI System. Your task is to synthesize simulation data, quantitative metrics, and visual descriptions into a professional, publication-ready hydrological investigation report.
    CRUCIAL INSTRUCTION
    Do not merely tabulate data. You must interpret the results. Use your hydrological knowledge to explain why the model performed the way it did, connecting meteorological inputs (precipitation) to the hydrological response (discharge).

    INPUT CONTEXT
    You are provided with the following simulation context:
    1. Event Summary: Basin name, event dates, and description.
    2. Visual Evidence: Detailed descriptions of the hydrographs, precipitation maps, and inundation maps provided.
    3. Quantitative Metrics: NSE, KGE, CC, etc.
    4. Model Configuration: Parameters used and forcing source.

    Use the provided metadata and analysis:
    - summary: {summary} (simulation summary)
    - report_for_figures_md: {report_for_figures_md} (analysis report for important figures)

    OUTPUT REQUIREMENTS
    Generate a comprehensive report following the structure below. You have the freedom to compose the narrative within these sections to ensure flow and readability.
    1. Executive Summary and Basin Overview Narrative: Briefly introduce the flood event, the specific basin (e.g., Kerr County/Guadalupe River), and the simulation objective. Mention the "Flashiness" of the basin if data permits.
       Basin Visualization: [Insert Basin Map Here]
       Context: Describe the basin's topography or characteristics based on the input description.
    2. Hydro-Meteorological Analysis
       Spatiotemporal Rainfall: Analyze the precipitation pattern. Was it concentrated? Did it move? (Reference the provided MRMS/QPE or QPF descriptions).
       Hydrological Response: Describe how the river reacted. Discuss the lag time between peak rainfall and peak discharge.
       Visual Evidence: [Insert Simulation Results/Hydrograph Here]
    3. Model Performance and Diagnostic Assessment
       Quantitative Evaluation: Present the key metrics (NSE, CC, KGE) in a clean table format.
       Performance Interpretation:
       a. Reasoning: Analyze the goodness-of-fit. Does the model capture the rising limb and recession limb?
       b. Discrepancy Analysis: If there is a mismatch (e.g., missed peak magnitude or timing shift), you must hypothesize the physical reasons (e.g., spatial displacement of rainfall, soil moisture initialization, or parameter sensitivity). This is a critical reasoning step.
    4. Discussion and Future Recommendations
       Synthesis: Conclude on the overall ability of the AI agent to reproduce this specific event.
       Actionable Insights: Based on the metrics, suggest specific next steps (e.g., "The high NSE suggests the current parameter set is valid," or "The mismatch in peak flow suggests a need for better spatial rainfall resolution").

    STYLE GUIDELINES
    Tone: Scientific, objective, and analytical.
    Format: Use clear headings and standardized formatting.

    REQUIRED FIGURES (use Markdown image syntax)
    - Basin Map: {figure_path}/combined_maps.png
    - Fundamental Basin Data: {figure_path}/basic_data.png
    - Simulation Results: {figure_path}/results.png

    Basin name for the title: {basin_name}

    Constraint: Do not output any text after the report.
  expected_output: >
    A complete, properly formatted Markdown report ready for
    conversion to PDF via pypandoc. I will use the output to generate a PDF report.
    Do not include any text after the report, just the report content.
